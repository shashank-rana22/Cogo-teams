name: Prod Deploy - New Admin

on:
  workflow_dispatch:

jobs:
  deploy:
    if: ${{ contains('prashantp01,riyazKhanCogoport,Ankitagar29,Kgarg28',github.actor) }}
    name: Deploying Servers via SSH
    runs-on: ubuntu-latest
    steps:
      - name: Deploying Admin Frontend
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.PROD_SERVER_SSH_HOST }}
          sync: true
          username: ubuntu
          key: ${{ secrets.PROD_SERVER_SSH_KEY }}
          script_stop: true
          command_timeout: 60m
          script: |
            cd cogo-admin
            git pull
            pnpm install
            pnpm run deploy
      
      - name: Notify Team
        if: ${{ success() }}
        run: |
          curl -X POST -H "Content-Type: application/json" -d '{
          "text": "Deployment on ${{ github.repository }} was completed!. Deployment was triggerd by ${{ github.actor }}."
          }' "https://cogofreight.webhook.office.com/webhookb2/2b4cef02-485b-4109-a57a-bdb242bee56d@fcbc2156-6b46-42c3-8745-0acb9d2dd22d/IncomingWebhook/745b829e328b4b2db27314c830e8fc38/b92c97ef-b062-4398-83c4-2d4b6ad67585"
            
